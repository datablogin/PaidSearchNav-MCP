# GitLeaks configuration for PaidSearchNav
# This file defines custom rules for detecting secrets specific to this project

title = "PaidSearchNav Secret Detection"

[extend]
# Use default rules as baseline
useDefault = true

# Custom rules for PaidSearchNav-specific secrets
[[rules]]
id = "google-ads-developer-token"
description = "Google Ads Developer Token"
regex = '''(?i)(google[_-]?ads[_-]?developer[_-]?token|PSN_GOOGLE_ADS_DEVELOPER_TOKEN)['"]*\s*[:=]\s*['"]?[A-Za-z0-9_-]{18,}'''
keywords = ["google_ads_developer_token", "PSN_GOOGLE_ADS_DEVELOPER_TOKEN"]

[[rules]]
id = "google-ads-client-secret"
description = "Google Ads Client Secret"
regex = '''(?i)(google[_-]?ads[_-]?client[_-]?secret|PSN_GOOGLE_ADS_CLIENT_SECRET)['"]*\s*[:=]\s*['"]?GOCSPX-[A-Za-z0-9_-]{28,}'''
keywords = ["google_ads_client_secret", "PSN_GOOGLE_ADS_CLIENT_SECRET", "GOCSPX-"]

[[rules]]
id = "google-ads-client-id"
description = "Google Ads Client ID"
regex = '''(?i)(google[_-]?ads[_-]?client[_-]?id|PSN_GOOGLE_ADS_CLIENT_ID)['"]*\s*[:=]\s*['"]?\d{12}-[a-z0-9]{32}\.apps\.googleusercontent\.com'''
keywords = ["google_ads_client_id", "PSN_GOOGLE_ADS_CLIENT_ID", "googleusercontent.com"]

[[rules]]
id = "google-ads-refresh-token"
description = "Google Ads Refresh Token"
regex = '''(?i)(google[_-]?ads[_-]?refresh[_-]?token|PSN_GOOGLE_ADS_REFRESH_TOKEN)['"]*\s*[:=]\s*['"]?1//[A-Za-z0-9_-]{43}'''
keywords = ["google_ads_refresh_token", "PSN_GOOGLE_ADS_REFRESH_TOKEN"]

[[rules]]
id = "psn-secret-key"
description = "PaidSearchNav Secret Key"
regex = '''(?i)(PSN_SECRET_KEY|secret[_-]?key)['"]*\s*[:=]\s*['"]?[A-Za-z0-9+/=]{32,}'''
keywords = ["PSN_SECRET_KEY", "secret_key"]

[[rules]]
id = "database-connection-string"
description = "Database Connection String"
regex = '''(?i)(connection[_-]?string|database[_-]?url|PSN_STORAGE_CONNECTION_STRING)['"]*\s*[:=]\s*['"]?(postgresql|mysql|sqlite)://[^'"\\s]+'''
keywords = ["connection_string", "database_url", "PSN_STORAGE_CONNECTION_STRING"]

[[rules]]
id = "aws-access-key"
description = "AWS Access Key"
regex = '''(?i)(aws[_-]?access[_-]?key[_-]?id)['"]*\s*[:=]\s*['"]?AKIA[0-9A-Z]{16}'''
keywords = ["aws_access_key_id", "AKIA"]

[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''(?i)(aws[_-]?secret[_-]?access[_-]?key)['"]*\s*[:=]\s*['"]?[A-Za-z0-9/+=]{40}\b'''
keywords = ["aws_secret_access_key"]

[[rules]]
id = "jwt-secret"
description = "JWT Secret"
regex = '''(?i)(jwt[_-]?secret|token[_-]?secret)['"]*\s*[:=]\s*['"]?[A-Za-z0-9+/=]{32,}'''
keywords = ["jwt_secret", "token_secret"]

[[rules]]
id = "bigquery-service-account"
description = "BigQuery Service Account JSON"
regex = '''(?i)(service[_-]?account|gcp[_-]?key)['"]*\s*[:=]\s*['"]?\{[^}]*"type"\s*:\s*"service_account"[^}]*"private_key"[^}]*\}'''
keywords = ["service_account", "private_key", "gcp_key"]

[[rules]]
id = "redis-password"
description = "Redis Password"
regex = '''(?i)(redis[_-]?password|redis[_-]?auth)['"]*\s*[:=]\s*['"]?[A-Za-z0-9!@#$%^&*()_+-=]{8,}'''
keywords = ["redis_password", "redis_auth"]

[allowlist]
description = "Allowlist for false positives"

# Allow test/example values with common test patterns
regexes = [
  # Test values - comprehensive patterns
  '''test[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key|password)''',
  '''example[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key|password)''',
  '''fake[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key|password)''',
  '''mock[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key|password)''',
  '''dummy[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key|password)''',
  '''sample[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key|password)''',
  
  # Common test database strings
  '''sqlite:///test\.db''',
  '''sqlite:///:memory:''',
  '''postgresql://test:test@localhost:5432/test''',
  '''postgresql://user:password@localhost/testdb''',
  '''mysql://test:test@localhost:3306/test''',
  
  # CI/CD test values
  '''"test_[^"]*"''',
  '''test_secret_key_for_ci_testing_only''',
  '''test_client_id''',
  '''test_client_secret''',
  '''test_refresh_token''',
  '''test_developer_token''',
  
  # Documentation placeholder values
  '''your[_-]?(client[_-]?id|client[_-]?secret|developer[_-]?token|refresh[_-]?token|secret[_-]?key)''',
  '''<[^>]*>''',                    # Placeholder values in documentation
  '''\{[^}]*\}''',                  # Template variables
  '''\$\{[^}]*\}''',               # Environment variable placeholders
  '''\[\w+\]''',                   # Configuration placeholders
  
  # Development and local values
  '''localhost''',
  '''127\.0\.0\.1''',
  '''0\.0\.0\.0''',
  
  # Common non-secret patterns that might trigger false positives
  '''version''',
  '''build''',
  '''commit''',
  '''hash''',
  '''checksum''',
  '''uuid''',
  '''id.*=.*[0-9]+''',             # Simple numeric IDs
  
  # Specific known false positives from our codebase
  '''184755303917-p5onefkq3cvafhdv7g5phhidbdne50es\.apps\.googleusercontent\.com''',  # Test client ID from CI
  '''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''',  # Test client secret from CI
  '''0C8BsPvjqQzVLj5LHartKg''',  # Test developer token from CI
  '''577-746-1198''',  # TopGolf test customer ID
  '''184755303917-s9l6hf5vc2c3gmc8bf2gmcec34qlte9d\.apps\.googleusercontent\.com''',  # Additional test client ID
  
  # Documentation placeholders - specific patterns found in our docs
  '''your-developer-token''',
  '''YOUR_DEVELOPER_TOKEN_HERE''',  
  '''your-client-id''',
  '''YOUR_CLIENT_ID_HERE''',
  '''your-client-secret''',
  '''YOUR_CLIENT_SECRET_HERE''',
  '''your-api-key''',
  '''eyJ0eXAiOiJKV1QiLCJhbGc\.\.\.''',  # Example JWT token in docs
  
  # Documentation variable names that shouldn't be flagged
  '''google_ads_developer_token.*=.*"your-developer-token"''',
  '''google_ads_developer_token.*=.*"YOUR_DEVELOPER_TOKEN"''',
  '''GOOGLE_ADS_DEVELOPER_TOKEN.*=.*"your-developer-token"''',
  '''export.*GOOGLE_ADS_DEVELOPER_TOKEN.*=.*"your-developer-token"''',
]

# Allow specific files that should be exempt from scanning
paths = [
  '''.github/workflows/.*\.ya?ml''',   # Allow test values in CI workflows
  '''tests/.*''',                      # Allow test values in all test directories
  '''.*test.*\.py''',                 # Allow test values in test files
  '''.*_test\.py''',                  # Allow test values in test files
  '''test_.*\.py''',                  # Allow test values in test files
  '''scripts/.*\.py''',               # Allow test values in utility scripts
  '''.*\.example\..*''',              # Allow example files
  '''.*\.sample\..*''',               # Allow sample files
  '''.*\.template\..*''',             # Allow template files
  '''README\.md''',                   # Allow documentation
  '''TROUBLESHOOTING\.md''',          # Allow troubleshooting docs
  '''docs/.*\.md''',                  # Allow documentation files
  '''DEPLOYMENT\.md''',               # Allow deployment documentation
  '''DEPLOYMENT_QUICK_START\.md''',   # Allow quick start deployment docs
  '''API_GUIDE\.md''',                # Allow API guide documentation
  '''GET_REFRESH_TOKEN_GUIDE\.md''',  # Allow auth guide documentation
  '''.secrets.baseline''',            # Allow detect-secrets baseline
  '''.gitleaks.toml''',               # Allow this configuration file
  '''.pre-commit-config.yaml''',      # Allow pre-commit config
  '''\.env\.example''',               # Allow env example files
  '''\.env\.template''',              # Allow env template files
  '''\.env\.local\..*''',             # Allow local env files (should be in .gitignore)
  '''\.env\.test''',                  # Allow test env files
  '''\.env\.dev''',                   # Allow dev env files with placeholders
  '''configs/.*\.json''',             # Allow client config files with test customer IDs
]