# Internationalization (i18n) Guide

This guide explains how to use the internationalization features in PaidSearchNav to support multiple languages and locales.

## Overview

PaidSearchNav supports comprehensive internationalization including:
- UI text translation in 6 languages
- Currency formatting for different locales
- Date and time formatting
- Number formatting with locale-specific separators
- API responses in user's preferred language

## Supported Languages

Currently supported languages:
- **en-US** - English (United States)
- **es-ES** - Spanish (Spain)
- **fr-FR** - French (France)
- **de-DE** - German (Germany)
- **ja-JP** - Japanese (Japan)
- **pt-BR** - Portuguese (Brazil)

## Using Translations in Code

### Basic Translation

```python
from paidsearchnav.i18n import gettext as _

# Simple translation
message = _("Add negative keywords to save {amount} per month")

# With formatting
formatted = _(
    "Add negative keywords to save {amount} per month",
    amount=format_currency(savings)
)
```

### Plural Forms

```python
from paidsearchnav.i18n import ngettext as _n

# Handles singular/plural based on count
message = _n(
    "{n} keyword found",
    "{n} keywords found",
    keyword_count
)
```

### Lazy Translation

For strings that should be translated at render time:

```python
from paidsearchnav.i18n import lazy_gettext as _lazy

# Translated when converted to string
error_message = _lazy("Invalid input provided")
```

## Formatting Functions

### Currency Formatting

```python
from paidsearchnav.i18n import format_currency

# Format with specific currency and locale
usd_amount = format_currency(1234.56, "USD", "en-US")  # ",234.56"
eur_amount = format_currency(1234.56, "EUR", "de-DE")  # "1.234,56 €"
jpy_amount = format_currency(1234, "JPY", "ja-JP")     # "¥1,234"
```

### Number Formatting

```python
from paidsearchnav.i18n import format_number, format_percentage

# Numbers with locale-specific separators
us_number = format_number(1234.56, language="en-US")    # "1,234.56"
de_number = format_number(1234.56, language="de-DE")    # "1.234,56"

# Percentages
percentage = format_percentage(0.1234)  # "12.3%"
```

### Date and Time Formatting

```python
from paidsearchnav.i18n import format_date, format_datetime
from datetime import datetime

now = datetime.now()

# Date formatting
us_date = format_date(now, "en-US")    # "03/15/2024"
de_date = format_date(now, "de-DE")    # "15.03.2024"
jp_date = format_date(now, "ja-JP")    # "2024年03月15日"

# DateTime formatting
us_datetime = format_datetime(now, "en-US")  # "03/15/2024 02:30 PM"
eu_datetime = format_datetime(now, "es-ES")  # "15/03/2024 14:30"
```

## API Usage

### Setting Language via Headers

The API automatically detects the user's preferred language from the `Accept-Language` header:

```bash
curl -H "Accept-Language: es-ES" https://api.paidsearchnav.com/api/v1/audits
```

### Query Parameter Override

You can override the language using the `lang` query parameter:

```bash
GET /api/v1/audits/123/report?lang=fr-FR
```

### Response Headers

API responses include the `Content-Language` header indicating the language used:

```
HTTP/1.1 200 OK
Content-Language: es-ES
Content-Type: application/json

{
    "titulo": "Informe de auditoría",
    "resumen": "Se encontraron 47 oportunidades..."
}
```

## Translating PaidSearchNav

### Extract Translatable Strings

Run the extraction script to update translation templates:

```bash
python scripts/extract_translations.py
```

This will:
1. Extract all translatable strings from Python files
2. Create/update the `.pot` template file
3. Update existing `.po` files for each language
4. Compile translations to `.mo` files

### Translation Workflow

1. **Mark strings for translation** in your code:
   ```python
   message = _("This string will be translated")
   ```

2. **Extract strings** using the script above

3. **Translate `.po` files** in `translations/{lang}/LC_MESSAGES/`:
   ```po
   msgid "Add negative keywords to save {amount} per month"
   msgstr "Añadir palabras clave negativas para ahorrar {amount} al mes"
   ```

4. **Compile translations** by running the extraction script again

### Translation Guidelines

- Use professional PPC terminology
- Maintain consistency across the application
- Consider text expansion (German ~30% longer than English)
- Test UI with longest translations
- Review with native-speaking PPC experts

## Configuration

### Default Language

Set the default language in environment variables:

```bash
PSN_DEFAULT_LANGUAGE=es-ES
```

### Custom Configuration

```python
from paidsearchnav.i18n import init_i18n, I18nConfig

config = I18nConfig(
    default_language="es-ES",
    fallback_language="en-US",
    cache_translations=True,
    cache_size=2000
)

init_i18n(config)
```

## Best Practices

1. **Always use translation functions** for user-facing text
2. **Include context comments** for translators:
   ```python
   # Translators: This appears in the keyword recommendations section
   message = _("Recommended bid adjustment")
   ```

3. **Handle formatting separately** from translation:
   ```python
   # Good
   amount = format_currency(value)
   message = _("Total savings: {amount}", amount=amount)
   
   # Bad
   message = _("Total savings: 234.56")
   ```

4. **Use lazy translation** for module-level strings
5. **Test with longest translations** to ensure UI doesn't break
6. **Validate number/date formats** match user expectations

## Testing Translations

### Unit Tests

```python
def test_spanish_translation():
    translator = get_translator()
    translator.set_language("es-ES")
    
    result = translator.gettext("Keywords")
    assert result == "Palabras clave"
```

### Manual Testing

1. Set browser language preferences
2. Use `Accept-Language` header in API calls
3. Add `?lang=XX-XX` to test specific languages
4. Verify formatting matches locale expectations

## Future Enhancements

- RTL language support (Arabic, Hebrew)
- Additional languages based on market demand
- Translation memory integration
- Automated translation quality checks
- User-contributed translations